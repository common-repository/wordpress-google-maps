/*! Google Maps Free - v2.5.4
 * https://wordpress.org/plugins/wordpress-google-maps/
 * Copyright (c) 2015; * Licensed GPLv2+ */
var AgmMapHandler;(function(t){t(function(){AgmMapHandler=function(e,i,a){var n,o,s=["medium","small","thumbnail","square","mini_square"],r=t(e),l=[],c=!1;a=void 0!==a?a:!0;var d=function(){o=i,i.zoom=i.zoom||i.defaults.zoom,i.zoom=parseInt(i.zoom)?parseInt(i.zoom):1,i.show_map="show_map"in i?i.show_map:1,i.show_posts="show_posts"in i?i.show_posts:0,i.show_markers="show_markers"in i?i.show_markers:1,i.show_images="show_images"in i?i.show_images:0,i.show_links="show_links"in i?i.show_links:1,i.snapping="snapping"in i.defaults?parseInt(i.defaults.snapping):1,i.show_panoramio_overlay="show_panoramio_overlay"in i?parseInt(i.show_panoramio_overlay):0,i.panoramio_overlay_tag="panoramio_overlay_tag"in i?i.panoramio_overlay_tag:"",i.street_view="street_view"in i?i.street_view:0,i.street_view_pos="street_view_pos"in i?i.street_view_pos:0,i.street_view_pov="street_view_pov"in i?i.street_view_pov:0,i.map_type=i.map_type||i.defaults.map_type,i.map_alignment=i.map_alignment||i.defaults.map_alignment,i.post_ids=i.post_ids||[],i.image_size=i.image_size||i.defaults.image_size,i.image_limit=i.image_limit||i.defaults.image_limit},h=function(){var e=t("#agm_mh_map_id").val();return!e||t(this).is(":disabled")?(window.alert(l10nStrings.please_save_map),!1):(A(),r.trigger("agm_map_insert",[e]),void 0)},m=function(){var e=t("#agm_map_title").val();if(!e)return window.alert(l10nStrings.map_name_missing),!1;var i=n.getStreetView(),a=t("#agm_map_size_x").is(":enabled")?t("#agm_map_size_x").val():0,o=t("#agm_map_size_y").is(":enabled")?t("#agm_map_size_y").val():0,s=t("input.agm_map_alignment_element:checked").val(),c={action:"agm_save_map",id:t("#agm_mh_map_id").val(),title:e,height:o,width:a,zoom:n.getZoom(),map_type:n.getMapTypeId(),show_map:t("#agm_map_show_map").is(":checked")?1:0,show_posts:t("#agm_map_show_posts").is(":checked")?1:0,map_alignment:s,show_markers:t("#agm_map_show_markers").is(":checked")?1:0,show_images:t("#agm_map_show_images").is(":checked")?1:0,show_links:t("#agm_map_show_links").is(":checked")?1:0,image_size:t("#agm_map_image_size").val(),image_limit:t("#agm_map_image_limit").val(),show_panoramio_overlay:t("#agm_map_show_panoramio_overlay").is(":checked")?1:0,panoramio_overlay_tag:t("#agm_map_panoramio_overlay_tag").val(),street_view:i.getVisible()?1:0,street_view_pos:i.getVisible()?[i.getPosition().lat(),i.getPosition().lng()]:0,street_view_pov:i.getVisible()?i.getPov():0,post_ids:[],markers:[]};t.each(t("input.agm_mh_associated_id"),function(e,i){c.post_ids[c.post_ids.length]=t(i).val()}),t("#agm_map_size_associate").is(":checked")&&(c.post_ids[c.post_ids.length]=t("#post_ID").val()),t.each(l,function(t,e){var i=e.getPosition();if(!i)return!0;var a={title:e.getTitle(),body:e._agmBody,icon:e.getIcon(),position:[i.lat(),i.lng()]};c.markers[c.markers.length]=a}),t.post(window.ajaxurl,c,function(e){e.status?(t("#agm_mh_map_id").val(parseInt(e.id)),t("#agm_insert_map").attr("disabled",!1),r.trigger("agm_map_saved",[parseInt(e.id)])):window.alert(l10nStrings.map_not_saved)})},p=function(){return i.post_ids.length?(t.post(window.ajaxurl,{action:"agm_get_post_titles",post_ids:i.post_ids},function(e){if(!e.posts)return!1;var i='<div class="agm_less_important">'+l10nStrings.already_associated_width+'<ul class="agm_associated_list">';t("#post_ID").val(),t.each(e.posts,function(t,e){i+="<li>"+e.post_title+"</li>"}),i+="</ul></div>",t("#agm_map_associated_posts").html(i)}),!1):(t("#agm_map_associated_posts").html(""),t("#agm_map_size_associate").attr("checked",!1),!1)},u=function(){var e="",n="";t.each(i.post_ids,function(t,i){e+='<input type="hidden" class="agm_mh_associated_id" value="'+i+'" />'}),t.each(s,function(t,e){var a=e===i.image_size?'selected="selected"':"";n+='<option value="'+e+'" '+a+">"+e+"</option>"}),r.html('<div id="agm_mh_header"><input type="hidden" id="agm_mh_map_id"><div class="agm_mh_container"><label>'+l10nStrings.add_location+" </label>"+'<input type="text" id="agm_mh_location" />'+'<input type="button" class="button-secondary action" id="agm_mh_location_trigger" value="'+l10nStrings.add+'" />'+'<div class="agm_less_important">'+l10nStrings.add_location_info+"</div>"+"</div>"+'<div class="agm_mh_container">'+l10nStrings.map_title+' <input type="text" size="32" id="agm_map_title" />'+"</div>"+'<div class="agm_mh_container">'+'<div id="agm_map_options_controls_container">'+'<input type="button" class="button-secondary action" id="agm_map_options" value="'+l10nStrings.options+'" />'+'<div id="agm_map_options_help" class="agm_less_important">'+l10nStrings.options_help+"</div>"+"</div>"+'<div id="agm_map_drop_marker_controls_container">'+'<input type="button" class="button-secondary action" id="agm_map_drop_marker" value="'+l10nStrings.drop_marker+'" />'+'<div id="agm_map_zoom_in_help" class="agm_less_important">'+l10nStrings.zoom_in_help+"</div>"+"</div>"+"</div>"+"</div>"+'<div id="agm_mh_options" style="display:none">'+'<div class="error below-h2"><p><a title="Upgrade Now" href="http://premium.wpmudev.org/project/wordpress-google-maps-plugin">Upgrade to Google Maps Pro to enable additional features and permanently disable links</a></p></div>'+"<div>"+'<input type="checkbox" id="agm_map_size_associate" value="'+t("#post_ID").val()+'" /> <label for="agm_map_size_associate">'+l10nStrings.map_associate+"</label>"+'<div class="agm_less_important">'+l10nStrings.association_help+"</div>"+e+'<div id="agm_map_associated_posts"></div>'+"</div>"+"<fieldset><legend>"+l10nStrings.map_size+"</legend>"+'<input type="text" size="3" id="agm_map_size_x" />'+"&nbsp;x&nbsp;"+'<input type="text" size="3" id="agm_map_size_y" />'+'<div><input type="checkbox" id="agm_map_size_default" /> <label for="agm_map_size_default">'+l10nStrings.use_default_size+"</label></div>"+"</fieldset>"+"<fieldset><legend>"+l10nStrings.map_appearance+"</legend>"+'<div><input type="checkbox" id="agm_map_show_links" /> <label for="agm_map_show_links">Show links</label></div>'+'<div><input type="checkbox" disabled="disabled" id="agm_map_show_posts" /> <label for="agm_map_show_posts">'+l10nStrings.show_posts+"</label></div>"+'<div><input type="checkbox" disabled="disabled" id="agm_map_show_map" /> <label for="agm_map_show_map">'+l10nStrings.show_map+"</label></div>"+'<div><input type="checkbox" disabled="disabled" id="agm_map_show_markers" /> <label for="agm_map_show_markers">'+l10nStrings.show_markers+"</label></div>"+"<div><fieldset>"+"<legend>"+l10nStrings.images_strip+"</legend>"+'<input type="checkbox" disabled="disabled" id="agm_map_show_images" /> <label for="agm_map_show_images">'+l10nStrings.show_images+"</label>"+"<br />"+'<label for="agm_map_image_size">'+l10nStrings.image_size+"</label> "+'<select disabled="disabled" id="agm_map_image_size">'+n+"</select>"+"<br />"+'<label for="agm_map_image_limit">'+l10nStrings.image_limit+"</label> "+'<input type="text" disabled="disabled" size="2" id="agm_map_image_limit" value="'+i.image_limit+'" />'+"</fieldset></div>"+"<fieldset><legend>"+l10nStrings.panoramio_overlay+"</legend>"+'<div><input type="checkbox" disabled="disabled" id="agm_map_show_panoramio_overlay" /> <label for="agm_map_show_panoramio_overlay">'+l10nStrings.show_panoramio_overlay+"</label></div>"+'<div><label for="agm_map_panoramio_overlay_tag">'+l10nStrings.panoramio_overlay_tag+'</label> <input type="text" disabled="disabled" size="12" id="agm_map_panoramio_overlay_tag" /></div>'+"<div><small>"+l10nStrings.panoramio_overlay_tag_help+"</small></div>"+"</fieldset>"+"<div><fieldset>"+"<legend>"+l10nStrings.map_alignment+"</legend>"+'<input type="radio" id="agm_map_alignment_left" name="ama" class="agm_map_alignment_element" value="left" />'+'<label for="agm_map_alignment_left"><img src="'+window._agm_root_url+'/img/system/left.png" />'+l10nStrings.map_alignment_left+"</label><br/>"+'<input type="radio" id="agm_map_alignment_center" name="ama" class="agm_map_alignment_element" value="center" />'+'<label for="agm_map_alignment_center"><img src="'+window._agm_root_url+'/img/system/center.png" />'+l10nStrings.map_alignment_center+"</label><br/>"+'<input type="radio" id="agm_map_alignment_right" name="ama" class="agm_map_alignment_element" value="right" />'+'<label for="agm_map_alignment_right"><img src="'+window._agm_root_url+'/img/system/right.png" />'+l10nStrings.map_alignment_right+"</label><br/>"+"</fieldset></div>"+"</fieldset>"+'<p class="agm_less_important">Global defaults are configured in Settings &gt; Google Maps</p>'+"</div>"+'<div id="map_preview"></div>'),r.append('<div id="agm_mh_footer"><div class="agm_mh_container">'+(a?'<input type="button" class="button-secondary action" id="agm_insert_map" value="'+l10nStrings.insert+'" />':"")+'<input type="button" class="button-primary" id="agm_save_map" value="'+l10nStrings.save+'" />'+'<input type="button" class="button-secondary action" id="agm_go_back" value="'+l10nStrings.go_back+'" />'+"</div>"+'<div class="agm_mh_container" id="agm_mh_markers">'+"</div>"+"</div>"),t("#map_preview").width(640).height(.35*t(window).height()),r.css({position:"absolute",width:"640px",height:"740px","overflow-y":"auto"}),t("#agm_mh_options").dialog({autoOpen:!1,title:l10nStrings.options,width:600,modal:!0,buttons:{OK:function(){t(this).dialog("close")}}}),t("#agm_mh_map_id").val(i.id),i.id||t("#agm_insert_map").attr("disabled",!0),t("#agm_map_title").val(i.title);var o=i.show_map&&parseInt(i.show_map)?!0:!1,l=i.show_posts&&parseInt(i.show_posts)?!0:!1,d=i.show_markers&&parseInt(i.show_markers)?!0:!1,h=i.show_images&&parseInt(i.show_images)?!0:!1,m=i.show_panoramio_overlay?!0:!1,u=i.show_links&&parseInt(i.show_links)?!0:!1;switch(t("#agm_map_show_links").attr("checked",u),t("#agm_map_show_map").attr("checked",o),t("#agm_map_show_posts").attr("checked",l),t("#agm_map_show_markers").attr("checked",d),t("#agm_map_show_images").click(function(){t("#agm_map_image_size").attr("disabled",!t(this).is(":checked")),t("#agm_map_image_limit").attr("disabled",!t(this).is(":checked"))}).attr("checked",h),t("#agm_map_image_size").attr("disabled",!t("#agm_map_show_images").is(":checked")),t("#agm_map_image_limit").attr("disabled",!t("#agm_map_show_images").is(":checked")),t("#agm_map_show_panoramio_overlay").click(g).attr("checked",m),t("#agm_map_panoramio_overlay_tag").change(function(){return c?(c.setTag(t(this).val()),void 0):!0}).val(i.panoramio_overlay_tag),i.map_alignment){case"right":t("#agm_map_alignment_right").attr("checked",!0);break;case"center":t("#agm_map_alignment_center").attr("checked",!0);break;case"left":t("#agm_map_alignment_left").attr("checked",!0);break;default:t("#agm_map_alignment_left").attr("checked",!0)}i.width&&parseInt(i.width)||t("#agm_map_size_default").attr("checked",!0),f(),t.each(i.post_ids,function(e,i){t("#post_ID").val()===i&&t("#agm_map_size_associate").attr("checked",!0)}),t("#agm_map_size_associate").click(function(){var e=t("#agm_map_size_associate").val();return t("#agm_map_size_associate").is(":checked")?i.post_ids?i.post_ids.push(e):i.post_ids=[e]:(t('input.agm_mh_associated_id[value="'+e+'"]').remove(),i.post_ids&&(i.post_ids=t.grep(i.post_ids,function(t){return t!==e}))),p(),!0})},g=function(){if(t("#agm_map_show_panoramio_overlay").is(":checked")){var e=t("#agm_map_panoramio_overlay_tag").val();c=new google.maps.panoramio.PanoramioLayer,e&&c.setTag(e),c.setMap(n)}else c&&(c.setMap(null),c=!1)},_=function(){var e=t("#agm_mh_options");return e.dialog("isOpen")?e.dialog("close"):e.dialog("open"),!1},f=function(){if(t("#agm_map_size_default").is(":checked"))t("#agm_map_size_x").val(i.defaults.width).attr("disabled",!0),t("#agm_map_size_y").val(i.defaults.height).attr("disabled",!0);else{var e=parseInt(i.width)>0?i.width:i.defaults.width,a=parseInt(i.height)>0?i.height:i.defaults.height;t("#agm_map_size_x").val(e).attr("disabled",!1),t("#agm_map_size_y").val(a).attr("disabled",!1)}},v=function(){i.markers&&t.each(i.markers,function(t,e){y(e.title,new google.maps.LatLng(e.position[0],e.position[1]),e.body,e.icon)})},w=function(){return y("Untitled marker",n.getCenter()),!1},y=function(t,e,a,o){a=a||"",o=o?window._agm_root_url+"/img/"+o:window._agm_root_url+"/img/system/marker.png";var s=l.length;n.setCenter(e);var r=new google.maps.Marker({title:t,map:n,icon:o,draggable:!0,clickable:!0,position:e}),c=new google.maps.InfoWindow({content:b(t,a,o,s),maxWidth:400});google.maps.event.addListener(r,"click",function(){c.open(n,r)}),r._agmInfo=c,i.snapping&&google.maps.event.addListener(r,"dragend",function(){var t=new google.maps.Geocoder;t.geocode({latLng:r.getPosition()},function(t,e){e===google.maps.GeocoderStatus.OK?(r.setPosition(t[0].geometry.location),r.setTitle(t[0].formatted_address),c.setContent(b(t[0].formatted_address,"",r.getIcon(),s)),T()):window.alert(l10nStrings.geocoding_error)})}),r._agmBody=a,l[s]=r,T()},b=function(t,e,i,a){return'<div class="agm_mh_info_content"><a href="#" class="agm_mh_info_icon_switch"><img agm:marker_id="'+a+'" src="'+i+'" /><br /><small>Icon</small></a>'+'<div class="agm_mh_info_text">'+'<div><label for="">'+l10nStrings.title+'</label><br /><input type="text" agm:marker_id="'+a+'" class="agm_mh_info_title" value="'+t+'" /></div>'+'<label for="">'+l10nStrings.body+'</label><textarea class="agm_mh_info_body" agm:marker_id="'+a+'">'+e+"</textarea>"+"</div>"+"</div>"},x=function(t){var e=t.replace(/[^0-9]+/,"");return parseInt(e)},k=function(){var e=t(this),i=x(e.attr("href")),a=l.splice(i,1);return a[0].setMap(null),T(),!1},S=function(){var e=t(this),a=x(e.attr("href")),o=l[a];if(n.setCenter(o.getPosition()),parseInt(i.street_view)){var s=n.getStreetView();s.setPosition(n.getCenter()),s.setVisible(!0)}return!1},T=function(){var e="<ul>";t.each(l,function(t,i){e+='<li><a href="#agm_mh_marker-'+t+'" class="agm_mh_marker_item">'+i.getTitle()+"</a>"+"&nbsp;"+'<span><a href="#agm_mh_marker-'+t+'" class="button-secondary action agm_mh_marker_delete_item">'+l10nStrings.delete_item+"</a></span>"+"</li>"}),e+="</ul>",t("#agm_mh_markers").html(e)},I=function(){var e=t(this).find("img").attr("agm:marker_id"),i=t(this).parent(".agm_mh_info_content"),a=i.html();t.post(window.ajaxurl,{action:"agm_list_icons"},function(n){var o="";t.each(n,function(t,e){o+='<a class="agm_new_icon" href="#"><img src="'+window._agm_root_url+"/img/"+e+'" /></a> '}),i.html(o),t(".agm_new_icon").click(function(){var n=t(this).find("img").attr("src");i.html(a),i.find("a.agm_mh_info_icon_switch img").attr("src",n);var o=l[e];o.setIcon(n),T()})})},C=function(){var e=t(this),i=e.attr("agm:marker_id"),a=l[i];a.setTitle(e.val()),a._agmInfo.setContent(b(a.getTitle(),a._agmBody,a.getIcon(),i)),T()},E=function(){var e=t(this),i=e.attr("agm:marker_id"),a=l[i];a._agmBody=e.val(),a._agmInfo.setContent(b(a.getTitle(),a._agmBody,a.getIcon(),i)),T()},z=function(){var e=t("#agm_mh_location").val();if(!e)return window.alert(l10nStrings.type_in_location),!1;var i=new google.maps.Geocoder;i.geocode({address:e},function(t,e){e===google.maps.GeocoderStatus.OK?y(t[0].formatted_address,t[0].geometry.location):window.alert(l10nStrings.geocoding_error)})},M=function(){if(d(),u(),n=new google.maps.Map(t("#map_preview").get(0),{zoom:parseInt(i.zoom),center:new google.maps.LatLng(40.7171,-74.0039),mapTypeId:google.maps.MapTypeId[i.map_type]}),navigator.geolocation&&!i.markers&&navigator.geolocation.getCurrentPosition(function(t){n.setCenter(new google.maps.LatLng(t.coords.latitude,t.coords.longitude))}),v(),g(),p(),parseInt(i.street_view)){var e=n.getStreetView(),a=i.street_view_pos?new google.maps.LatLng(i.street_view_pos[0],i.street_view_pos[1]):n.getCenter();e.setPosition(a),i.street_view_pov&&e.setPov({heading:parseInt(i.street_view_pov.heading),pitch:parseInt(i.street_view_pov.pitch),zoom:parseInt(i.street_view_pov.zoom)}),e.setVisible(!0)}t("#agm_map_drop_marker").click(w),t("#agm_go_back").click(A),t("#agm_insert_map").click(h),t("#agm_map_options").click(_),t("#agm_save_map").click(m),t("#agm_mh_location_trigger").click(z),t("#agm_map_size_default").click(f),t(".agm_mh_marker_item").live("click",S),t(".agm_mh_marker_delete_item").live("click",k),t(".agm_mh_info_icon_switch").live("click",I),t(".agm_mh_info_title").live("change",C),t(".agm_mh_info_body").live("change",E)},A=function(){L(),r.trigger("agm_map_close")},L=function(){r.empty(),t(".agm_mh_marker_item").die("click"),t(".agm_mh_marker_delete_item").die("click"),t(".agm_mh_info_icon_switch").die("click"),t(".agm_mh_info_title").die("change"),t(".agm_mh_info_body").die("change")},$=function(){window._agmMapIsLoaded?M():window.setTimeout($,100)};return $(),{destroy:L}}})})(jQuery);